<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="rover_4wd">

        <!-- rover properties -->
    <xacro:property name="track_width" value="0.08"/>
    <xacro:property name="total_width" value="0.4515"/>
    <xacro:property name="total_length" value="0.422"/>
    <xacro:property name="total_height" value="0.202"/>
    <xacro:property name="chassis_width" value="0.241"/>
    <xacro:property name="chassis_height" value="0.0785"/>
    <xacro:property name="chassis_length" value="0.320"/>
    <xacro:property name="track_distance" value="0.2915"/>
    <xacro:property name="wheel_axes_distance" value="0.220"/>
    <xacro:property name="wheel_collision_x" value="${total_length/2 - total_height/2 - 0.001}"/>
    <xacro:property name="wheel_collision_y" value="${track_width}"/>
    <xacro:property name="wheel_collision_z" value="${total_height - 0.02}"/>
    <xacro:property name="rover_z_elev" value="${total_height/2 - chassis_height/2}"/>
    <xacro:property name="collision_z_elev" value="${chassis_height/2}"/>
    


    <!-- Robot Parameters -->
    <xacro:property name="wheel_z_offset" value="0.020" />
    <xacro:property name="wheel_x_offset" value="${wheel_axes_distance/2}" /> <!-- <xacro:property name="wheel_x_offset" value="0.145" /> -->
    <xacro:property name="front_flipper_x_offset" value="-0.0035" />
    <xacro:property name="wheel_y_offset" value="${(total_width-track_width)/2}" /> <!-- <xacro:property name="wheel_y_offset" value="0.18" /> -->
    <xacro:property name="track_y_offset" value="0.11" />
    <xacro:property name="wheel_mass" value="1.25" />
    <xacro:property name="chassis_mass" value="4.53592" />

    <!-- Part Includes - Payload, Sensors, Etc.. -->
    <!-- Comment or Uncomment any of these to add them to the dev payload -->
    <!-- You can always link them elsewhere if you wish by editing accessories/<sensor>.urdf -->
    <xacro:property name="payload_z_offset" value="0.096" />
    <xacro:include filename="$(find roverrobotics_description)/urdf/accessories/rover_dev_payload.urdf" />
    <xacro:include filename="$(find roverrobotics_description)/urdf/accessories/rplidar_s2.urdf" />
    <xacro:include filename="$(find roverrobotics_description)/urdf/accessories/imu.urdf" />

    <!-- Robot Definition -->
    <link name="base_link" />
    <link name="chassis_link">

        <visual>
            <origin xyz="0 0 -0.035" rpy="0 0 0" />
            <geometry>
                <mesh filename="file://$(find rover_description_pkg)/meshes/prisma_rover.dae" scale="0.001 0.001 0.001"/>
            </geometry>
        </visual>

        <!-- <visual>
            <origin xyz="0 0 0" rpy="1.57 -0 1.57" />
            <geometry>
                <mesh filename="file://$(find roverrobotics_description)/meshes/flipper_chassis.dae"/>
            </geometry>
        </visual>
        <visual>
            <origin xyz="0 ${track_y_offset} 0" rpy="1.57 3.1415 0" />
            <geometry>
                <mesh filename="file://$(find roverrobotics_description)/meshes/flipper_track.dae"/>
            </geometry>
        </visual> -->

        <!-- <collision>
            <origin xyz="0 ${track_y_offset} 0" rpy="1.57 3.1415 0" />
            <geometry>
                <mesh filename="file://$(find roverrobotics_description)/meshes/flipper_track.dae"/>
            </geometry>
        </collision> -->

         <!-- <visual>
            <origin xyz="0 ${-track_y_offset} 0" rpy="1.57 3.1415 0" />
            <geometry>
                <mesh filename="file://$(find roverrobotics_description)/meshes/flipper_track.dae"/>
            </geometry>
        </visual> -->


        <!-- <collision>
            <origin xyz="0 ${-track_y_offset} 0" rpy="1.57 3.1415 0" />
            <geometry>
                <mesh filename="file://$(find roverrobotics_description)/meshes/flipper_track.dae"/>
            </geometry>
        </collision> -->
        <collision>
            <origin xyz="0.0 0.0 ${collision_z_elev}" rpy="0.0 0.0 0.0"/>
            <geometry>
                <box size="${total_length} ${total_width - 2*track_width} ${total_height - 0.0005}"/>
            </geometry>
        </collision>

        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <mass value="${chassis_mass}" />
            <inertia ixx="0.028064" ixy="0.0"  ixz="0.0" iyy="0.08226" iyz="0.0" izz="0.10258" />
        </inertial>
    </link>

    <joint name="base_to_chassis" type="fixed">
        <parent link="base_link"/>
        <child link="chassis_link"/>
        <origin xyz="0 0 0.125"/>
    </joint>


    <link name="fr_wheel_link">
        <visual>
            <origin xyz="0 0 0" rpy="-1.57 0 0" />
            <geometry>
                <mesh filename="file://$(find roverrobotics_description)/meshes/pro_tire.dae" scale="0.5 0.5 1.0"/>
            </geometry>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="-1.57 0 0" />
            <geometry>
                <cylinder radius="${total_height/2}" length="${track_width}"/>
            </geometry>
        </collision>

        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <mass value="${wheel_mass}" />
            <inertia ixx="0.005645" ixy="0.0"  ixz="0.0" iyy= "0.01008" iyz="0.0" izz="0.005645"/>
        </inertial>
        <mu>5.0</mu>
    </link>
    <joint name="fr_wheel_to_chassis" type="continuous">
        <parent link="chassis_link"/> 
        <child link="fr_wheel_link"/>
        <axis xyz="0 1 0"/>
        <origin xyz="${wheel_x_offset + front_flipper_x_offset} ${-wheel_y_offset} 0" rpy="0 0 0"/>
    </joint>

    <link name="fl_wheel_link">
        <visual>
            <origin xyz="0 0 0" rpy="1.57 0 0" />
            <geometry>
                <mesh filename="file://$(find roverrobotics_description)/meshes/pro_tire.dae" scale="0.5 0.5 1.0"/>
            </geometry>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="1.57 0 0" />
            <geometry>
                <cylinder radius="${total_height/2}" length="${track_width}"/>
            </geometry>
        </collision>

        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <mass value="${wheel_mass}" />
            <inertia ixx="0.005645" ixy="0.0"  ixz="0.0" iyy= "0.01008" iyz="0.0" izz="0.005645"/>
        </inertial>
        <mu>5.0</mu>
    </link>
    <joint name="fl_wheel_to_chassis" type="continuous">
        <parent link="chassis_link"/>
        <child link="fl_wheel_link"/>
        <axis xyz="0 1 0"/>
        <origin xyz="${wheel_x_offset + front_flipper_x_offset} ${wheel_y_offset} 0" rpy="0 0 0"/>
    </joint>

    <link name="rr_wheel_link">
        <visual>
            <origin xyz="0 0 0" rpy="1.57 0 3.1415" />
            <geometry>
                <mesh filename="file://$(find roverrobotics_description)/meshes/pro_tire.dae" scale="0.5 0.5 1.0"/>
            </geometry>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="1.57 0 3.1415" />
            <geometry>
                <cylinder radius="${total_height/2}" length="${track_width}"/>
            </geometry>
        </collision>

        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <mass value="${wheel_mass}" />
            <inertia ixx="0.005645" ixy="0.0"  ixz="0.0" iyy= "0.01008" iyz="0.0" izz="0.005645"/>
        </inertial>
        <mu>5.0</mu>
    </link>
    <joint name="rr_wheel_to_chassis" type="continuous">
        <parent link="chassis_link"/>
        <child link="rr_wheel_link"/>
        <axis xyz="0 1 0"/>
        <origin xyz="${-wheel_x_offset} ${-wheel_y_offset} 0"/>
    </joint>

    <link name="rl_wheel_link">
        <visual>
            <origin xyz="0 0 0" rpy="-1.57 0 3.1415" />
            <geometry>
                <mesh filename="file://$(find roverrobotics_description)/meshes/pro_tire.dae" scale="0.5 0.5 1.0"/>
            </geometry>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="-1.57 0 3.1415" />
            <geometry>
                <cylinder radius="${total_height/2}" length="${track_width}"/>
            </geometry>
        </collision>

        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <mass value="${wheel_mass}" />
            <inertia ixx="0.005645" ixy="0.0"  ixz="0.0" iyy= "0.01008" iyz="0.0" izz="0.005645"/>
        </inertial>
        <mu>5.0</mu>
    </link>
    <joint name="rl_wheel_to_chassis" type="continuous">
        <parent link="chassis_link"/>
        <child link="rl_wheel_link"/>
        <axis xyz="0 1 0"/>
        <origin xyz="${-wheel_x_offset} ${wheel_y_offset} 0"/>
    </joint>

    <!-- palo link -->

  <joint name="pole_to_payload" type="fixed">
    <origin xyz="0 0 ${ 0.5 - total_height/2}" rpy="0 0 0"/>
    <parent link="payload_link"/>
    <child link="pole_link"/>
  </joint>

  <link name="pole_link">
    <collision>
      <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
        <geometry>
            <cylinder radius="0.0125" length="${1.1-2*total_height}"/>
        </geometry>
    </collision>

  </link>
    <!-- camera part -->
  <joint name="camera_to_payload" type="fixed">
    <origin xyz="0.02 0 ${1 -0.085 - total_height}" rpy="0 0 0"/>
    <parent link="payload_link"/>
    <child link="camera_link"/>
  </joint>


  <link name="camera_link">
    <visual>
     <origin xyz="0 0 0" rpy="1.57 0 1.57"/>
      <geometry>
            <mesh filename="file://$(find rover_description_pkg)/meshes/realsense.dae "/>
      </geometry>
    </visual>
    <collision>
      <origin xyz="-0.01 0.0 0.0" rpy="0 0 0"/>
      <geometry>
        <box size="0.02 0.1 0.025"/>
      </geometry>
    </collision>

  </link>

  <joint name="camera_rgb_joint" type="fixed">
    <origin xyz="0.005 0.018 0.013" rpy="0 0 0"/>
    <!-- <origin xyz="${r200_cam_rgb_px} ${r200_cam_rgb_py} ${r200_cam_rgb_pz}" rpy="0 0 0"/> -->
    <parent link="camera_link"/>
    <child link="camera_rgb_frame"/>
  </joint>
  <link name="camera_rgb_frame"/>

  <joint name="camera_rgb_optical_joint" type="fixed">
    <origin xyz="0 0 0" rpy="-1.57 0 -1.57"/>
    <parent link="camera_rgb_frame"/>
    <child link="camera_rgb_optical_frame"/>
  </joint>
  <link name="camera_rgb_optical_frame"/>

  <joint name="camera_depth_joint" type="fixed">
    <origin xyz="0.005 0.028 0.013" rpy="0 0 0"/>
    <!-- <origin xyz="${r200_cam_rgb_px} ${r200_cam_rgb_py + r200_cam_depth_offset} ${r200_cam_rgb_pz}" rpy="0 0 0"/> -->
    <parent link="camera_link"/>
    <child link="camera_depth_frame"/>
  </joint>
  <link name="camera_depth_frame"/>

  <joint name="camera_depth_optical_joint" type="fixed">
    <!-- <origin xyz="0 0 0" rpy="-1.57 0 -1.57"/> -->
    <origin xyz="0 0 0" rpy="0 0 0"/> 
    <parent link="camera_depth_frame"/>
    <child link="camera_depth_optical_frame"/>
  </joint>
  <link name="camera_depth_optical_frame"/>

    <gazebo reference="camera_link">
        <sensor name="d435_camera" type="camera">
            <topic>camera/image_raw</topic>
            <ignition_frame_id>rover/camera_link</ignition_frame_id>
            <gz_frame_id>rover/camera_link</gz_frame_id>
            <camera name="d435">
                <camera_info_topic>camera/camera_info</camera_info_topic>
                <horizontal_fov>1.21126</horizontal_fov>
				<image>
					<width>640</width>
					<height>480</height>
					<format>RGB_INT8</format>
				</image>
				<clip>
					<near>0.1</near>
					<far>100</far>
				</clip>
				<noise>
					<type>gaussian</type>
					<mean>0</mean>
					<stddev>0.007</stddev>
				</noise>
            </camera>
            <always_on>true</always_on>
            <update_rate>10</update_rate>
            <visualize>true</visualize>
        </sensor>

		<sensor name="d435_depth" type="depth_camera">
			<always_on>1</always_on>
			<update_rate>10</update_rate>
			<visualize>0</visualize>
			<topic>camera/depth</topic>
            <ignition_frame_id>rover/camera_depth_optical_frame</ignition_frame_id>
			<pose>0 0.0175 0.5125 0 -0 0</pose>
			<camera name="d435">
                <point_cloud_topic>camera/depth/points</point_cloud_topic>
				<horizontal_fov>1.48702</horizontal_fov>
				<image>
					<width>1280</width>
					<height>720</height>
				</image>
				<clip>
					<near>0.1</near>
					<far>100</far>
				</clip>
				<!-- <noise>
					<type>gaussian</type>
					<mean>0</mean>
					<stddev>0.007</stddev>
				</noise> -->
			</camera>
		</sensor>        
    </gazebo>
    
    

    <!-- Gazebo Plugins -->
    <gazebo>
        <plugin name="ignition::gazebo::systems::DiffDrive" filename="ignition-gazebo-diff-drive-system"> 
            <num_wheel_pairs>2</num_wheel_pairs>
            <!-- Wheel Information -->
            <left_joint>rl_wheel_to_chassis</left_joint>
            <left_joint>fl_wheel_to_chassis</left_joint>
            <right_joint>rr_wheel_to_chassis</right_joint>
            <right_joint>fr_wheel_to_chassis</right_joint>
            <wheel_separation>0.37</wheel_separation>
            <wheel_radius>0.102</wheel_radius>

            <!-- Limits -->
            <max_linear_acceleration>5</max_linear_acceleration>
            <min_linear_acceleration>-5</min_linear_acceleration>
            <max_angular_acceleration>4</max_angular_acceleration>
            <min_angular_acceleration>-4</min_angular_acceleration>

            
            <!-- Output -->
            <frame_id>rover/odom</frame_id>
            <child_frame_id>rover/base_link</child_frame_id>

            <!-- Topics -->
            <topic>/cmd_vel</topic>
            <odom_topic>/odom/wheels</odom_topic>
            <tf_topic>/tf_gazebo</tf_topic>

        </plugin>

        <plugin filename="ignition-gazebo-joint-state-publisher-system" name="ignition::gazebo::systems::JointStatePublisher">
            <topic>/joint_states</topic>
        </plugin>      

    </gazebo>


</robot>
